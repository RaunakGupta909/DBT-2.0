<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>State DBT Heatmapping</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <style>
        /* Custom Styles */
        :root {
            --bg: #f8f9fa;
            --text: #212529;
            --muted: #6c757d;
            --card-bg: #ffffff;
            --card-border: #dee2e6;
            --header-bg: #5b55c4b1;
            --shadow: rgba(0,0,0,0.05);
        }

        body.dark {
            --bg: #1a1a1a;
            --text: #ffffff;
            --muted: #cccccc;
            --card-bg: #2d2d2d;
            --card-border: #444444;
            --header-bg: #042842;
            --shadow: rgba(255,255,255,0.1);
        }

        body {
            background-color: var(--bg);
            color: var(--text);
            transition: background 0.3s ease, color 0.3s ease;
        }
        .dashboard-header {
            background-color: var(--header-bg);
            color: white;
            padding: 15px 0;
            margin-bottom: 20px;
            position: relative;
        }
        .dark-mode-toggle {
            position: absolute;
            top: 10px;
            right: 20px;
        }
        .dark-mode-toggle button {
            background: transparent;
            border: none;
            cursor: pointer;
            font-size: 1.2rem;
            padding: 8px;
            border-radius: 6px;
            transition: background 0.3s ease;
        }
        .dark-mode-toggle button:hover {
            background: rgba(255,255,255,0.1);
        }
        .section-container {
            background-color: var(--card-bg);
            color: var(--text);
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px var(--shadow);
            margin-bottom: 20px;
            border: 1px solid var(--card-border);
        }
        .section-container h3 {
            color: var(--text);
        }
        /* Heatmap Placeholder Styling */
        .heatmap-placeholder {
            min-height: 550px;
            background-color: #e9ecef;
            border: 2px solid #00bcd4;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.2rem;
            color: #495057;
            text-align: center;
            border-radius: 5px;
        }
        body.dark .heatmap-placeholder {
            background-color: #3d3d3d;
            color: #cccccc;
        }
        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }
        .color-box {
            width: 25px;
            height: 25px;
            margin-right: 10px;
            border-radius: 3px;
        }
        /* Bootstrap overrides for dark mode */
        body.dark .table {
            color: var(--text);
        }
        body.dark .table-striped tbody tr:nth-of-type(odd) {
            background-color: rgba(255,255,255,0.05);
        }
        body.dark .table-hover tbody tr:hover {
            background-color: rgba(255,255,255,0.1);
        }
        body.dark .table thead th {
            background-color: var(--card-bg);
            color: var(--text);
            border-color: var(--card-border);
        }
        body.dark .table td {
            border-color: var(--card-border);
        }
        .back-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            padding: 8px 12px;
            font-size: 14px;
            color: white;
            background-color: #0d6efd;
            border-radius: 6px;
            text-decoration: none;
            transition: background 0.3s;
            z-index: 1000;
        }
        .back-btn:hover {
            background-color: #0b5ed7;
            color: white;
        }
    </style>
</head>
<body>
    <a href="state_dbt_officer_dashboard.html" class="back-btn">← Back to Dashboard</a>

    <header class="dashboard-header text-center">
        <div class="container">
            <h1>State Heatmapping (District Performance)</h1>
            <p class="lead">State DBT Cell / Admin Section</p>
        </div>
    </header>

    <div class="container">

        <div class="row mb-4 g-4">
            
            <div class="col-lg-9">
                <div class="section-container">
                    <h3>District-wise Performance Heatmap (State View)</h3>
                    <div class="heatmap-placeholder">
                        <p>
                            [Interactive Map Placeholder for Selected State]<br>
                            ***Note: Real map requires GeoJSON data and libraries like Leaflet/D3.js.***<br>
                            <small>Map colors dynamically change based on the selected metric.</small>
                        </p>
                    </div>
                </div>
            </div>

            <div class="col-lg-3">
                <div class="section-container">
                    <h3>Metric Selection & Legend</h3>
                    
                    <label for="metricSelect" class="form-label fw-bold">Select Metric:</label>
                    <select class="form-select mb-4" id="metricSelect" onchange="applyFilters()">
                        <option value="disbursement" selected>Total Disbursement Amount (Cr)</option>
                        <option value="adherence">Scheme Adherence Score</option>
                        <option value="latency">Transaction Latency (Days)</option>
                    </select>
                    
                    <h5>Performance Scale</h5>
                    <div class="legend-item">
                        <div class="color-box" style="background-color: #dc3545;"></div> 
                        <span>**Tier 3:** High Risk / Low Performance</span>
                    </div>
                    <div class="legend-item">
                        <div class="color-box" style="background-color: #ffc107;"></div> 
                        <span>**Tier 2:** Moderate Risk / Medium Performance</span>
                    </div>
                    <div class="legend-item">
                        <div class="color-box" style="background-color: #28a745;"></div> 
                        <span>**Tier 1:** Low Risk / High Performance</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mb-4">
            <div class="col-12">
                <div class="section-container">
                    <h3>District Performance Data Table</h3>
                    <div class="table-responsive">
                        <table class="table table-striped table-hover" id="districtDataTable">
                            <thead class="table-info">
                                <tr>
                                    <th>#</th>
                                    <th>District Name</th>
                                    <th>Disbursement (₹ Cr)</th>
                                    <th>Adherence Score (%)</th>
                                    <th>Latency (Days)</th>
                                    <th>Tier Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // --- JavaScript for Data Handling and Table Population/Filtering ---

        // Sample Data for Districts in a State
        const districtData = [
            { id: 1, name: 'District A (North)', disbursement: 450, adherence: 95, latency: 1.5, tier: 'Tier 1' },
            { id: 2, name: 'District B (Central)', disbursement: 210, adherence: 82, latency: 3.8, tier: 'Tier 2' },
            { id: 3, name: 'District C (East)', disbursement: 120, adherence: 75, latency: 5.2, tier: 'Tier 3' },
            { id: 4, name: 'District D (West)', disbursement: 380, adherence: 91, latency: 2.1, tier: 'Tier 1' },
            { id: 5, name: 'District E (South)', disbursement: 180, adherence: 78, latency: 4.5, tier: 'Tier 2' },
        ];

        // Function to determine badge class based on Tier
        function getTierBadge(tier) {
            let badgeClass = 'bg-secondary';
            if (tier === 'Tier 1') badgeClass = 'bg-success';
            else if (tier === 'Tier 2') badgeClass = 'bg-warning text-dark';
            else if (tier === 'Tier 3') badgeClass = 'bg-danger';
            return `<span class="badge ${badgeClass}">${tier}</span>`;
        }

        // --- Populate District Table (Initial Load) ---
        function populateTable(data) {
            const tbody = document.querySelector('#districtDataTable tbody');
            tbody.innerHTML = ''; 

            data.forEach(item => {
                const row = tbody.insertRow();
                row.insertCell().innerText = item.id;
                row.insertCell().innerText = item.name;
                row.insertCell().innerText = item.disbursement.toLocaleString();
                row.insertCell().innerText = item.adherence.toFixed(0) + '%';
                row.insertCell().innerText = item.latency.toFixed(1);
                row.insertCell().innerHTML = getTierBadge(item.tier);
            });
        }
        populateTable(districtData); // Load all data initially

        // --- Function to Simulate Filter/Map Change ---
        function applyFilters() {
            const selectedMetric = document.getElementById('metricSelect').value;
            alert(`Heatmap metric changed to: ${selectedMetric}. In a real application, the map colors and table sorting would update now.`);
            
            // Simulation of dynamic data update based on the selected metric:
            let sortedData = [...districtData];
            
            if (selectedMetric === 'latency') {
                 // Latency: Lowest value is best (Tier 1)
                 sortedData.sort((a, b) => a.latency - b.latency);
                 // Apply tiers based on new sorting (simplified)
                 sortedData.forEach((d, index) => {
                     if (index < 2) d.tier = 'Tier 1';
                     else if (index < 4) d.tier = 'Tier 2';
                     else d.tier = 'Tier 3';
                 });
            } else {
                 // Disbursement/Adherence: Highest value is best (Tier 1)
                 let sortBy = selectedMetric === 'disbursement' ? 'disbursement' : 'adherence';
                 sortedData.sort((a, b) => b[sortBy] - a[sortBy]);
                 // Apply tiers based on new sorting (simplified)
                 sortedData.forEach((d, index) => {
                     if (index < 2) d.tier = 'Tier 1';
                     else if (index < 4) d.tier = 'Tier 2';
                     else d.tier = 'Tier 3';
                 });
            }
            populateTable(sortedData);
        }
    </script>
    <script>
        // Dark mode initialization - check localStorage and apply if enabled
        document.addEventListener('DOMContentLoaded', function() {
            const isDarkMode = localStorage.getItem('darkMode') === 'true';
            if (isDarkMode) {
                document.body.classList.add('dark');
            }
        });
    </script>
</body>
</html>
