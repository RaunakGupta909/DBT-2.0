<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DBT Card</title>

<style>
    :root {
        --bg: #f5f7fa;
        --text: #111;
        --muted: #444;
        --card-bg: #ffffff;
        --card-border: #eaeaea;
        --btn-bg: #005bbb;
        --btn-hover: #004a99;
        --shadow: rgba(0,0,0,0.12);
        --shadow-hover: rgba(0,0,0,0.18);
    }

    body.dark-mode {
        --bg: #1a1a1a;
        --text: #ffffff;
        --muted: #cccccc;
        --card-bg: #2d2d2d;
        --card-border: #444444;
        --btn-bg: #007bff;
        --btn-hover: #0056b3;
        --shadow: rgba(255,255,255,0.1);
        --shadow-hover: rgba(255,255,255,0.2);
    }

    body {
        font-family: Arial, sans-serif;
        background: var(--bg);
        margin: 0;
        padding: 40px;
        transition: background 0.3s ease;
    }

    .role-grid {
        display: grid;
        grid-template-columns: repeat(3, minmax(280px, 1fr));
        gap: 25px;
        justify-content: center;
        margin-top: 60px;
    }

    /* #### CARD #### */
    .role-card {
        background: var(--card-bg);
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 4px 12px var(--shadow);
        transition: all 0.3s ease;
        cursor: pointer;
        border: 1px solid var(--card-border);
        position: relative;
        overflow: hidden;
    }

    .role-card:hover {
        transform: translateY(-6px);
        box-shadow: 0 10px 20px var(--shadow-hover);
        border-top: 5px solid var(--btn-bg);
    }

    /* ICON STYLE LIKE IMAGE */
    .role-badge {
        font-size: 45px;
        margin-bottom: 10px;
        animation: floatIcon 2.5s infinite ease-in-out;
    }

    @keyframes floatIcon {
        0% { transform: translateY(0px); }
        50% { transform: translateY(-5px); }
        100% { transform: translateY(0px); }
    }

    /* TITLE */
    .role-card h3 {
        margin: 0;
        font-size: 20px;
        font-weight: 700;
        color: var(--text);
        animation: fadeSlide 1.2s ease;
    }

    /* DESCRIPTION */
    .role-card p {
        margin-top: 8px;
        color: var(--muted);
        font-size: 14px;
        line-height: 1.4;
        animation: fadeSlide 1.4s ease;
    }

    /* BUTTON */
    .proceed-btn {
        display: inline-block;
        margin-top: 15px;
        padding: 10px 14px;
        font-size: 14px;
        color: white;
        background: var(--btn-bg);
        border-radius: 8px;
        text-decoration: none;
        transition: 0.3s;
    }

    .proceed-btn:hover {
        background: var(--btn-hover);
    }

    @keyframes fadeSlide {
        from { opacity: 0; transform: translateY(6px); }
        to   { opacity: 1; transform: translateY(0px); }
    }

    /* Chat widget styles (paste into page) */
#dbt-chatbot-btn {
  position: fixed; right: 22px; bottom: 22px;
  width: 60px; height: 60px; border-radius: 50%;
  background:#005bbb; color:#fff; display:flex; align-items:center; justify-content:center;
  box-shadow: 0 8px 20px rgba(0,0,0,0.22); cursor:pointer; z-index:2147483647;
}
#dbt-chat-window {
  position: fixed; right: 22px; bottom: 96px; width: 360px; max-width: calc(100% - 48px);
  height: 520px; background: #fff; border-radius: 12px; box-shadow: 0 16px 40px rgba(2,6,23,0.2);
  display: none; flex-direction: column; overflow: hidden; z-index:2147483647;
  font-family: Arial, Helvetica, sans-serif;
}
#dbt-chat-header { background:#005bbb; color:#fff; padding:12px 14px; display:flex; align-items:center; justify-content:space-between;}
#dbt-chat-messages { flex:1; padding:12px; overflow:auto; background: #f7f9fc; }
.dbt-msg { margin:8px 0; max-width:82%; padding:10px 12px; border-radius:10px; line-height:1.3; }
.dbt-msg.user { margin-left:auto; background:#005bbb; color:#fff; border-bottom-right-radius:2px; }
.dbt-msg.bot { margin-right:auto; background:#fff; color:#111; border:1px solid #e6e9ef; }
#dbt-chat-input { padding:10px; display:flex; gap:8px; border-top:1px solid #eee; background:#fff; }
#dbt-chat-input input { flex:1; padding:10px 12px; border:1px solid #ddd; border-radius:8px; }
.dbt-small { font-size:12px; color:#cfe0ff; opacity:0.95; }
#dbt-mode { font-size:12px; color:#eef6ff; opacity:0.95; margin-left:8px; }
.dbt-footer-note { font-size:11px; color:#666; padding:8px 12px; text-align:center; border-top:1px solid #f1f3f6; }
</style>

</head>
<body>


    <a href="index.html" class="back-btn">‚Üê Back to Home</a>

<style>
.back-btn {
    position: absolute;
    top: 20px;     /* upar se distance */
    left: 20px;    /* left side se distance */
    padding: 10px 14px;
    margin: 0;
    font-size: 14px;
    color: white;
    background: var(--btn-bg);
    border-radius: 8px;
    text-decoration: none;
    transition: 0.3s;
    z-index: 1000;
}

.back-btn:hover {
    background: var(--btn-hover);
}

body.dark-mode .back-btn {
    color: var(--text);
}
</style>

<div class="role-grid">

  <!-- DBT Card -->
  <article class="role-card student" onclick="location.href='student_dbt_login.html'">
    <div class="role-badge">üéì</div>
    <h3>DBT Status Check</h3>
    <p>Verify with Aadhaar to check your bank seeding status.</p>
    <a class="proceed-btn" href="student_dbt_login.html">Proceed ‚Üí</a>
  </article>


<article class="role-card student" onclick="location.href='gamified_zone.html'">
    <div class="role-badge">üéì</div>
    <h3>Gamified Zone</h3>
    <p>Quizzes, leaderboard,and badges for engagement</p>
    <a class="proceed-btn" href="gamified_zone.html">Proceed ‚Üí</a>
  </article>


<article class="role-card student" onclick="location.href='raise_issue.html'">
    <div class="role-badge">üéì</div>
    <h3>Raise Issue</h3>
    <p>Submit DBT mismatch complaints</p>
    <a class="proceed-btn" href="raise_issue.html">Proceed ‚Üí</a>
  </article>

<article class="role-card student" onclick="location.href='student_ambassador_resources.html'">
    <div class="role-badge">üéì</div>
    <h3>Student Ambassador</h3>
    <p>Spreading Awareness about DBT linked account</p>
    <a class="proceed-btn" href="student_ambassador_resources.html">Proceed ‚Üí</a>
</article>

  

  <article class="role-card student" onclick="location.href='learning_zone.html'">
    <div class="role-badge">üéì</div>
    <h3>Learning Zone</h3>
    <p>Infographics, explainers, and voice guides</p>
    <a class="proceed-btn" href="learning_zone.html">Proceed ‚Üí</a>
  </article>

<article class="role-card student" onclick="location.href='parent_share.html'">
    <div class="role-badge">üéì</div>
    <h3>Parent Share</h3>
    <p>One-tap WhatsApp sharing of DBT status</p>
    <a class="proceed-btn" href="parent_share.html">Proceed ‚Üí</a>
  </article>



</div>

<!-- START: DBT AI Chatbot Widget -->
<style>
/* Chat widget styles (paste into page) */
#dbt-chatbot-btn {
  position: fixed; right: 22px; bottom: 22px;
  width: 60px; height: 60px; border-radius: 50%;
  background:#005bbb; color:#fff; display:flex; align-items:center; justify-content:center;
  box-shadow: 0 8px 20px rgba(0,0,0,0.22); cursor:pointer; z-index:2147483647;
}
#dbt-chat-window {
  position: fixed; right: 22px; bottom: 96px; width: 360px; max-width: calc(100% - 48px);
  height: 520px; background: #fff; border-radius: 12px; box-shadow: 0 16px 40px rgba(2,6,23,0.2);
  display: none; flex-direction: column; overflow: hidden; z-index:2147483647;
  font-family: Arial, Helvetica, sans-serif;
}
#dbt-chat-header { background:#005bbb; color:#fff; padding:12px 14px; display:flex; align-items:center; justify-content:space-between;}
#dbt-chat-messages { flex:1; padding:12px; overflow:auto; background: #f7f9fc; }
.dbt-msg { margin:8px 0; max-width:82%; padding:10px 12px; border-radius:10px; line-height:1.3; }
.dbt-msg.user { margin-left:auto; background:#005bbb; color:#fff; border-bottom-right-radius:2px; }
.dbt-msg.bot { margin-right:auto; background:#fff; color:#111; border:1px solid #e6e9ef; }
#dbt-chat-input { padding:10px; display:flex; gap:8px; border-top:1px solid #eee; background:#fff; }
#dbt-chat-input input { flex:1; padding:10px 12px; border:1px solid #ddd; border-radius:8px; }
.dbt-small { font-size:12px; color:#cfe0ff; opacity:0.95; }
#dbt-mode { font-size:12px; color:#eef6ff; opacity:0.95; margin-left:8px; }
.dbt-footer-note { font-size:11px; color:#666; padding:8px 12px; text-align:center; border-top:1px solid #f1f3f6; }
</style>

<div id="dbt-chatbot-btn" title="DBT AI">
  <svg width="26" height="26" viewBox="0 0 24 24" fill="none"><path d="M21 15a2 2 0 0 1-2 2H9l-6 4V5a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v10z" stroke="#fff" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/></svg>
</div>

<div id="dbt-chat-window" role="dialog" aria-label="DBT chatbot">
  <div id="dbt-chat-header">
    <div><strong>DBT Awareness Bot</strong><div id="dbt-mode" class="dbt-small">Mode: Local</div></div>
    <div style="display:flex;gap:8px;align-items:center;">
      <button id="dbt-toggle-mode" style="background:transparent;border:0;color:#fff;cursor:pointer;font-size:14px">Switch</button>
      <button id="dbt-close" style="background:transparent;border:0;color:#fff;cursor:pointer;font-size:18px">‚úï</button>
    </div>
  </div>

  <div id="dbt-chat-messages" aria-live="polite"></div>

  <div id="dbt-chat-input">
    <input id="dbt-user-input" type="text" placeholder="Ask: What is DBT? or type 'help'..." aria-label="Type a message">
    <button id="dbt-send" style="background:#005bbb;color:#fff;border:0;padding:10px 12px;border-radius:8px;cursor:pointer">Send</button>
  </div>

  <div class="dbt-footer-note">Built-in quick intents: what_is_dbt, dbt_techniques, crisis_help, mindfulness_exercises</div>
</div>

<script>
/*
  DBT Chatbot client-side code.
  Modes:
   - "local": uses built-in intent keyword matching (ready-to-run)
   - "botpress": forwards user message to Botpress webchat (if configured/hosted)
   - "dialogflow_demo": embed Dialogflow Web Demo iframe link or fallback
*/
(function(){
  // CONFIG - change these to connect to your services
  const CONFIG = {
    mode: 'local', // 'local' | 'botpress' | 'dialogflow_demo'
    // Botpress config (if using botpress): host (no trailing slash), botId
    botpress: { host: 'http://localhost:3000', botId: 'dbt-bot' },
    // Dialogflow web demo URL (if you created Dialogflow ES project with Web Demo)
    dialogflowDemoUrl: '', // e.g. 'https://console.dialogflow.com/api-client/demo/embedded/<AGENT_ID>'
  };

  // ELEMENTS
  const btn = document.getElementById('dbt-chatbot-btn');
  const win = document.getElementById('dbt-chat-window');
  const closeBtn = document.getElementById('dbt-close');
  const sendBtn = document.getElementById('dbt-send');
  const input = document.getElementById('dbt-user-input');
  const messages = document.getElementById('dbt-chat-messages');
  const modeLabel = document.getElementById('dbt-mode');
  const toggleModeBtn = document.getElementById('dbt-toggle-mode');

  // Basic helpers
  function addMessage(text, who='bot') {
    const div = document.createElement('div');
    div.className = 'dbt-msg ' + (who === 'user' ? 'user' : 'bot');
    div.innerText = text;
    messages.appendChild(div);
    messages.scrollTop = messages.scrollHeight;
  }

  function setModeLabel(mode) {
    modeLabel.innerText = 'Mode: ' + (mode || CONFIG.mode).replace('_',' ');
  }

  // LOCAL Intent matcher
  function matchIntent(text) {
    const t = (text || '').toLowerCase();
    // Direct synonyms
    if (/what\s+is\s+dbt|define\s+dbt|dbt\?/i.test(t) || t.includes('what is dbt')) return 'what_is_dbt';
    if (/(technique|techniques|how to do dbt|skills|skills practice)/i.test(t) || t.includes('technique')) return 'dbt_techniques';
    if (/(crisis|help me|suicid|emerg|i am feeling)/i.test(t)) return 'crisis_help';
    if (/(mindful|mindfulness|breath|exercise|meditat)/i.test(t)) return 'mindfulness_exercises';
    if (t === 'help' || t === 'intents' || t === 'commands') return 'help';
    return 'fallback';
  }

  // Local responses
  const RESPONSES = {
    what_is_dbt: "DBT (Direct Benifi tranfer) is a set of skills to help manage emotions, tolerate distress, improve relationships, and practice mindfulness. For awareness we focus on skills like 'Mindfulness', 'Distress Tolerance', 'Emotion Regulation', and 'Interpersonal Effectiveness'.",
    dbt_techniques: "Key DBT techniques: 1) Mindfulness ‚Äî notice the present moment. 2) Distress Tolerance ‚Äî coping tools for crisis. 3) Emotion Regulation ‚Äî understand & reduce vulnerability to intense emotions. 4) Interpersonal Effectiveness ‚Äî assertiveness & boundaries. Want examples for any of these?",
    crisis_help: "If someone is in immediate danger, call emergency services. If you're feeling overwhelmed, please contact local crisis lines or a trusted adult. For non-emergency support, try grounding techniques like 5-4-3-2-1 sensory exercise or 'TIPP' (Temperature, Intense exercise, Paced breathing, Paired muscle relaxation).",
    mindfulness_exercises: "Simple 3-step mindfulness: 1) Sit comfortably for 2 minutes. 2) Focus on breath ‚Äî count 4 inhale, 4 exhale. 3) Notice thoughts and gently return to breath. Repeat for 5 cycles.",
    help: "You can ask: 'What is DBT?', 'Give DBT techniques', 'I'm in crisis', 'Mindfulness exercise'. To connect a human, contact your college admin.",
    fallback: "Sorry, I didn't understand. Try asking: 'What is DBT?' or 'Give DBT techniques'."
  };

  // Botpress forwarding (simple post to /api/v1/bots/<botId>/converse? or use webchat)
  async function forwardToBotpress(message) {
    try {
      // If Botpress webchat is available, we can init its widget instead of server call.
      // Here we attempt a simple converse via Botpress HTTP API (may require token).
      const { host, botId } = CONFIG.botpress || {};
      if (!host || !botId) throw new Error('Botpress not configured');
      // NOTE: Botpress REST API and auth vary by version. This is a best-effort demo call.
      const resp = await fetch(`${host}/api/v1/bots/${botId}/converse`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ type: 'text', text: message })
      });
      if (!resp.ok) throw new Error('Botpress call failed');
      const j = await resp.json();
      // Try to extract text from response
      if (Array.isArray(j.responses) && j.responses.length) {
        return j.responses.map(r => r.text).join('\n') || JSON.stringify(j.responses);
      } else if (j.type === 'success' && j.responses) {
        return JSON.stringify(j.responses);
      } else {
        return JSON.stringify(j);
      }
    } catch (err) {
      console.error('Botpress forward error:', err);
      return 'Botpress request failed: ' + (err.message || err);
    }
  }

  // Dialogflow demo fallback: open Dialogflow demo iframe
  function openDialogflowDemo() {
    const url = CONFIG.dialogflowDemoUrl;
    if (!url) { addMessage('Dialogflow demo URL not configured.', 'bot'); return; }
    // open small window with iframe
    const iframe = document.createElement('iframe');
    iframe.src = url;
    iframe.style.width = '100%';
    iframe.style.height = '100%';
    iframe.style.border = '0';
    // replace chat messages area with iframe
    messages.innerHTML = '';
    messages.appendChild(iframe);
  }

  // Handle user message
  async function handleUserMessage(txt) {
    if (!txt || !txt.trim()) return;
    addMessage(txt, 'user');

    // Choose behavior by CONFIG.mode
    const mode = CONFIG.mode || 'local';
    setModeLabel(mode);
    if (mode === 'local') {
      const intent = matchIntent(txt);
      const answer = RESPONSES[intent] || RESPONSES.fallback;
      addMessage(answer, 'bot');
    } else if (mode === 'botpress') {
      addMessage('Connecting to Botpress...', 'bot');
      const res = await forwardToBotpress(txt);
      addMessage(res || RESPONSES.fallback, 'bot');
    } else if (mode === 'dialogflow_demo') {
      openDialogflowDemo();
    } else {
      addMessage('Unknown chat mode. Switch to Local or configure Botpress/Dialogflow.', 'bot');
    }
  }

  // EVENTS
  btn.addEventListener('click', () => {
    win.style.display = (win.style.display === 'flex') ? 'none' : 'flex';
    win.style.flexDirection = 'column';
    if (win.style.display === 'flex') input.focus();
  });
  closeBtn.addEventListener('click', ()=>{ win.style.display='none'; });

  sendBtn.addEventListener('click', ()=>{ handleUserMessage(input.value); input.value=''; input.focus(); });
  input.addEventListener('keydown', (e)=>{ if (e.key === 'Enter') { e.preventDefault(); sendBtn.click(); }});

  toggleModeBtn.addEventListener('click', ()=>{
    // Cycle modes: local -> botpress -> dialogflow_demo -> local
    const modes = ['local','botpress','dialogflow_demo'];
    let i = modes.indexOf(CONFIG.mode);
    i = (i + 1) % modes.length;
    CONFIG.mode = modes[i];
    setModeLabel(CONFIG.mode);
    // If switching to dialogflow_demo and URL configured, open iframe
    if (CONFIG.mode === 'dialogflow_demo' && CONFIG.dialogflowDemoUrl) {
      addMessage('Dialogflow demo will open in the chat window.', 'bot');
    } else {
      addMessage('Chat mode switched to: ' + CONFIG.mode, 'bot');
    }
  });

  // Init greeting
  setModeLabel(CONFIG.mode);
  addMessage('Hi ‚Äî I am DBT Awareness Bot. Ask about DBT, techniques, crisis help or mindfulness exercises. Type "help" for suggestions.', 'bot');

  // Expose a small global API for runtime config
  window.DBTChatbot = {
    setMode: (m) => { CONFIG.mode = m; setModeLabel(m); },
    configureBotpress: (host, botId) => { CONFIG.botpress.host = host; CONFIG.botpress.botId = botId; },
    configureDialogflowDemo: (url) => { CONFIG.dialogflowDemoUrl = url; }
  };
})();
</script>
<!-- END: DBT AI Chatbot Widget -->
<script src="script.js"></script>
<script>
// Apply dark mode based on localStorage (connected to home page toggle)
document.addEventListener('DOMContentLoaded', function() {
    const isDarkMode = localStorage.getItem('darkMode') === 'true';
    if (isDarkMode) {
        document.body.classList.add('dark-mode');
    }
});
</script>
</body>
</html>
